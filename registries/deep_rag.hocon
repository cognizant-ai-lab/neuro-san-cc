
# Copyright (C) 2023-2025 Cognizant Digital Business, Evolutionary AI.
# All Rights Reserved.
# Issued under the Academic Public License.
#
# You can be released from the terms, and requirements of the Academic Public
# License by purchasing a commercial license.
# Purchase of a commercial license is mandatory for any use of the
# neuro-san SDK Software in commercial settings.
#
# END COPYRIGHT

# The schema specifications for this file are documented here:
# https://github.com/cognizant-ai-lab/neuro-san/blob/main/docs/agent_hocon_reference.md

{
    # Optional metadata describing this agent network
    "metadata": {
        "description": "Demonstartion of Abstract Deep RAG",
        "tags": ["rag"],
    },
    "llm_config": {
        "model_name": "gpt-4o",
    },
    "tools": [
        # This first agent definition is regarded as the "Front Man", which
        # does all the talking to the outside world/client.
        #
        # Some disqualifications from being a front man:
        #   1) Cannot use a CodedTool "class" definition
        #   2) Cannot use a Tool "toolbox" definition
        #
        # Besides the first agent being the front man, these tool definitions
        # do not have to be in any particular order. How they are linked and
        # call each other is defined within their own specs.
        # This could be a graph, potentially even with cycles.
        {
            "name": "deep_rag",

            # Note that there are no parameters defined for this guy's "function" key.
            # This is the primary way to identify this tool as a front-man,
            # distinguishing it from the rest of the tools.

            "function": {

                # The description acts as an initial prompt.
                "description": """
Give me a list of .txt files and I will create a Deep RAG
multi-agent network for you for deep insights into the text
beyond what regular RAG can do.

Good, consistent naming of the .txt files can help in defining a high-level
structure for the resulting agent network, and the order in which files
are presented can matter to the creation of the resulting network.
Any one file name should be descriptive enough to aid in proposing high-level
structure for the resulting network.

Providing some hints as to how you have structured the file names will also help.
"""
            },

            "instructions": """
1.  Take the list of file names given in the text and send them to the rough_structure
    tool to determine the high-level structure for the resulting network.
    Call the JSON output of this step the grouping_json.

2.  Pass the full grouping_json to the create_network tool.

Return what the create_network tool returns as output
""",
            "tools": ["rough_structure", "create_network"],

            "allow": {
                "to_upstream": {
                    # Specifying this allows sly_data keys from this network to be passed back
                    # to the calling client
                    "sly_data": ["agent_reservations", "aa_grouping_json"]
                }
            }
        },

        {
            "name": "rough_structure",
            "function": {
                "description": """
Creates the grouping_json
""",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "file_list": {
                            "type": "array",
                            "description": """
A list of file names that together contains the content to explore.
The order of these file names can matter.
""",
                            "items": {
                                "type": "string"
                            }
                        },
                        "user_description": {
                            "type": "string",
                            "description": """
This is a description of how the individual files in the file_list might be organized.
"""
                        },
                        "grouping_constraints": {
                            "type": "string",
                            "description": """
This is an optional description of any grouping constraints from the user.
"""
                        },
                    }
                },
            },
            "instructions": """
Examine the names of the files in the file_list and take into account any user_description
of the file naming structure to come up with a JSON structure
which describes the following:
* A short "name" for the body of work that is being pieced up which must be less that 40 characters.
* A "description" of the overall strategy for how the files are to be grouped.
    If you must mention the word 'files' in your description, use the word 'content' instead.
* A "groups" list which contains one JSON entry for each of the groups, each entry of which has:
    1. A short "name" for the group which is unique, less than 40 characters and
        is the primary reference to the group in snake case.
    2. A "description" of the group and how it is unique from the other groups.
    3. A "files" dictionary whose keys are each of the files that belong in the group and
       whose values are a snake case translation of the file name.

Constraints:
* Each and every file in the file_list must be represented in
  at least one group.
* Any single group may have at least one, but never more than 7 files in it.
* There can be at most 7 groups.
* Whenever possible follow the advice in the grouping_constraints, if that is present.

Output the JSON structure described.
""",
        },
        {
            "name": "create_network",
            "function": {
                "description": "Processes the grouping_json structure to create a network.",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "files_directory": {
                            "type": "string"
                        },
                        "grouping_json": {
                            "type": "object",
                            "properties": {
                                "name": {
                                    "type": "string"
                                },
                                "description": {
                                    "type": "string"
                                },
                                "groups": {
                                    "type": "array",
                                    "items": {
                                        "type": "object"
                                         # Not necessary to go into detail yet. Trusting the caller.
                                    }
                                }
                            },
                            "required": ["name", "description", "groups"]
                        }
                    },
                    "required": ["files_directory", "grouping_json"]
                }
            },

            "class": "create_networks.CreateNetworks",
            "allow": {
                "reservations": True
            }
        }
    ]
}
